#!/usr/bin/env ruby
require 'rubygems'
require 'bundler/setup'
require 'optparse'
require 'ostruct'
require File.expand_path(File.dirname(__FILE__) + '/../lib/smeagol')

# Parse options
options = Smeagol::OptionParser.parse(ARGV)

# Run the auto update process
if options.git && options.auto_update
  Thread.new do
    while true do
      sleep 86400
      Smeagol::Updater.update(options.git, options.repository_paths)
    end
  end
end

# Clear the caches
options.repository_paths.each do |path|
  Smeagol::Cache.new(Gollum::Wiki.new(path)).clear()
end

# Run the web server
Smeagol::App.set(:repository_paths, options.repository_paths)
Smeagol::App.set(:git, options.git)
Smeagol::App.set(:cache_enabled, options.cache_enabled)
Smeagol::App.run!(:port => options.port)


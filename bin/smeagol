#!/usr/bin/env ruby

def self.main(argv)
  commands = %w{help init build sync preview update server serve}
  command = commands.include?(argv.first) ? argv.shift : 'server'

  case command
  when 'help'
    puts "usage: smeagol [COMMAND] [OPTIONS]"
    puts
    puts "COMMANDS:"
    commands.each do |c|
      puts "  #{c}"
    end
    puts
    puts "Default command if none given is `server'."
  when 'init'
    require 'smeagol'
    Smeagol::CLI.init(argv)
  when 'build'
    require 'smeagol'
    Smeagol::CLI.build(argv)
  when 'update'
    require 'smeagol'
    Smeagol::CLI.update(argv)
  when 'sync'
    require 'smeagol'
    Smeagol::CLI.sync(argv)
  when 'preview'
    require 'smeagol'
    Smeagol::CLI.preview(argv)   
  when 'server', 'serve'
    # TODO: make daemon the default (once it actually works)?
    if ARGV.include?('-d')
      ARGV.delete('-d')
      require 'daemons'
      Daemons.run_proc(File.basename(__FILE__)) do
        require 'smeagol'
        Smeagol::CLI.serve(argv)
      end
    else
      require 'smeagol'
      Smeagol::CLI.serve(argv)
    end
  end
end

main(ARGV)

